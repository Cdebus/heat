language: python
python:
  - "3.5"
cache:
  directories:
  - $HOME/virtualenv/python3.5/lib/python3.5/site-packages
before_install:
  - sudo apt-get install -y libopenmpi-dev openmpi-bin libhdf5-dev
  - travis_wait 32 ./install-torch.sh
  - pip install codecov pytest pytest-cov
install:
  - pip install -e .[hdf5] .
script:
  - mpirun pytest --cov=heat
after_success:
  - codecov
deploy:
  provider: pypi
  user: bhagemeier
  password:
    secure: FZn28EGIpfVMT7CTjAdjHW2eQ1frPlthEhWWHBzRZDI/EVXuGx+6DqxwinCwo3SdPzg9NBg7FD9CPZ3QYwy573yJXTMJtiGRm9UkTFcu0ZGv8SmgAwP3GHJlMAoSUJXeM/kbUFV70pytJacEritSlXDLZMBG1Ad4kFWyGOrU21o749DQkhPpIMWqB8qa7M2OgSpiAp62I3/yNLqfuh2ToBK0MQ/mr6rOdHP26S2FArLjGtyA0RK1vON6yl4VCffb3UC4AF4q4g6RUa81hanEcRtMH/3V9sveXRxsRxkWbYP94vthQKpZ2a5ca3X6tZRrfn9C23PymYZuPYhx+JMSGgj7tVgzJoxPl555/et9m3Wkoo6AjjrZmQOMs/wo4vNBkQWhBCiNK8DVn8lYCU/YfXue/fNkM2jYSyFZ9WbqEY/LB1TWo4KDcPlm/e+e+NHiu/L7+AC13BG/QCfNRIdM9xYyXT39vKCvsG1K1+CS5f44VM/kNqE3is2UUV3EhFjY6eqG5aa5URi8gTK6JEDZvRw6l1j6ZTximlFGePXhHb9NBFhIelCVb+ZyutWh4HFDuwzHBDGuOwaNi+xqFKqFtQBO9SzcCKc98TOlksnMd1ngMH1kV79zOGLys9kNA5A2Vlzyv/qBExur1Q2cRq78Qy6gsJb8yhyK47mygk8gkJ0=
  on:
    tags: true
